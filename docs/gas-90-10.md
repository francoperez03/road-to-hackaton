---
title: Gas 90/10 - Optimización Práctica
description: 10 hotspots que cubren 90% de optimizaciones de gas en Solidity
---

# Gas 90/10 - Optimización Práctica

## Los 10 hotspots que importan

### 1. Custom Errors vs String Literals

| ❌ Evitá | ✅ Haz | 🔧 Micro-diff |
|----------|---------|---------------|
| `require(x, "Insufficient balance")` | `revert InsufficientBalance()` | 7K gas menos |

**Antes/Después:**
```solidity
// ❌ Antes: ~23k gas
require(balance >= amount, "Insufficient balance");

// ✅ Después: ~16k gas  
error InsufficientBalance();
if (balance < amount) revert InsufficientBalance();
```

### 2. Storage Packing

| ❌ Evitá | ✅ Haz | 🔧 Micro-diff |
|----------|---------|---------------|
| `uint256` para flags | `uint8` + packing | 15K gas menos por slot |

**Antes/Después:**
```solidity
// ❌ Antes: 3 storage slots (60k gas)
bool isActive;
uint256 timestamp;  
uint256 counter;

// ✅ Después: 2 storage slots (40k gas)
struct State {
    bool isActive;     // 1 byte
    uint32 timestamp;  // 4 bytes (suficiente hasta 2106)
    uint32 counter;    // 4 bytes + padding = 32 bytes total
}
```

### 3. Constants vs Variables

| ❌ Evitá | ✅ Haz | 🔧 Micro-diff |
|----------|---------|---------------|
| Storage para valores fijos | `constant`/`immutable` | 2K gas menos por acceso |

**Antes/Después:**
```solidity
// ❌ Antes: SLOAD (2100 gas)
uint256 public maxSupply = 10000;

// ✅ Después: directo en bytecode (~3 gas)
uint256 public constant MAX_SUPPLY = 10000;
```

### 4. Loop Optimization

| ❌ Evitá | ✅ Haz | 🔧 Micro-diff |
|----------|---------|---------------|
| Repeated array.length | Cache length | 3 gas por iteración |

**Antes/Después:**
```solidity
// ❌ Antes: SLOAD en cada iteración
for (uint i = 0; i < items.length; i++) {
    process(items[i]);
}

// ✅ Después: 1 SLOAD total
uint length = items.length;
for (uint i = 0; i < length; i++) {
    process(items[i]);
}
```

### 5. Function Visibility

| ❌ Evitá | ✅ Haz | 🔧 Micro-diff |
|----------|---------|---------------|
| `public` para internal | `external`/`internal` | 200 gas menos |

**Antes/Después:**
```solidity
// ❌ Antes: copia calldata a memory
function updateState(uint[] memory data) public {
    _processData(data);
}

// ✅ Después: usa calldata directly  
function updateState(uint[] calldata data) external {
    _processData(data);
}
```

### 6. Short-circuit Optimization

| ❌ Evitá | ✅ Haz | 🔧 Micro-diff |
|----------|---------|---------------|
| Expensive check first | Cheap check first | Variable gas savings |

**Antes/Después:**
```solidity
// ❌ Antes: external call siempre se ejecuta
if (expensiveExternalCall() && balance > 0) {
    // logic
}

// ✅ Después: short-circuit en casos comunes
if (balance > 0 && expensiveExternalCall()) {
    // logic
}
```

### 7. Bytes32 vs String

| ❌ Evitá | ✅ Haz | 🔧 Micro-diff |
|----------|---------|---------------|
| `string` para IDs cortos | `bytes32` | 1K gas menos por storage |

**Antes/Después:**
```solidity
// ❌ Antes: string storage (~22k gas)
mapping(address => string) public usernames;

// ✅ Después: bytes32 storage (~20k gas)
mapping(address => bytes32) public usernames;
```

### 8. Batch Operations

| ❌ Evitá | ✅ Haz | 🔧 Micro-diff |
|----------|---------|---------------|
| Multiple transactions | Single batch call | 21K gas menos por tx evitada |

**Antes/Después:**
```solidity
// ❌ Antes: N transacciones
function transfer(address to, uint amount) external {
    _transfer(msg.sender, to, amount);
}

// ✅ Después: 1 transacción
function batchTransfer(address[] calldata to, uint[] calldata amounts) external {
    for (uint i = 0; i < to.length; i++) {
        _transfer(msg.sender, to[i], amounts[i]);
    }
}
```

### 9. State Variable Order

| ❌ Evitá | ✅ Haz | 🔧 Micro-diff |
|----------|---------|---------------|
| Random ordering | Size-optimized order | 20K gas menos en deployment |

**Antes/Después:**
```solidity
// ❌ Antes: 3 slots (desperdicia espacio)
bool flag1;        // slot 0: 1 byte + 31 bytes padding
uint256 bigNumber; // slot 1: 32 bytes
bool flag2;        // slot 2: 1 byte + 31 bytes padding

// ✅ Después: 2 slots
uint256 bigNumber; // slot 0: 32 bytes
bool flag1;        // slot 1: 1 byte
bool flag2;        // slot 1: 1 byte (mismo slot)
```

### 10. Event Optimization

| ❌ Evitá | ✅ Haz | 🔧 Micro-diff |
|----------|---------|---------------|
| Many indexed parameters | 3 indexed max | 375 gas por parameter extra |

**Antes/Después:**
```solidity
// ❌ Antes: 4 indexed (1 va a data, extra gas)
event Transfer(
    address indexed from,
    address indexed to, 
    uint indexed tokenId,
    uint indexed blockNumber  // Este va a data
);

// ✅ Después: 3 indexed exactos
event Transfer(
    address indexed from,
    address indexed to,
    uint indexed tokenId,
    uint blockNumber  // No indexed
);
```

## Quick wins (implementar en 5min)

1. **Replace require strings** con custom errors
2. **Add constant/immutable** a valores que no cambian
3. **Pack small values** en mismo storage slot
4. **Cache array lengths** en loops
5. **Use calldata** instead of memory en external functions

## Herramientas

- `forge test --gas-report` para gas profiling
- `solc --optimize --optimize-runs=200` 
- Tenderly gas profiler para análisis detallado
- Remix gas estimator para quick checks

---

::: tip Regla 90/10
**Estos 10 patterns cubren ~90% de las optimizaciones** que vas a necesitar en hackathones.
:::